pkgname="flatbuffers25"
pkgdesc="Memory Efficient Serialization Library"
pkgver="25.9.23"
pkgrel=0
url="https://github.com/google/flatbuffers"
source="$pkgname-$pkgver.tar.gz::https://github.com/google/flatbuffers/archive/refs/tags/v${pkgver}.tar.gz flatbuffers.patch"
depends_dev="linux-headers $pkgname"
makedepends="$depends_dev libc-dev cmake clang19"
license="Apache-2.0"
depends=""
arch="all"
builddir="$srcdir"/$pkgname-v$pkgver
subpackages="$pkgname-dev"

build() {
    cmake -B . -G Ninja \
          -DCMAKE_C_COMPILER=/usr/lib/llvm19/bin/clang \
          -DCMAKE_CXX_COMPILER=/usr/lib/llvm19/bin/clang++ \
          -DCMAKE_INSTALL_PREFIX=/usr \
          -DCMAKE_INSTALL_LIBDIR=lib -Wno-dev \
          -DCMAKE_BUILD_TYPE=MinSizeRel \
		  -DFLATBUFFERS_BUILD_SHAREDLIB=ON \
		  -DFLATBUFFERS_BUILD_FLATLIB=OFF
    cmake --build . -j
}

package() {
    DESTDIR="$pkgdir" cmake --install .
}
